{% extends "base.html" %}
{% block additional_preloads %}
<link rel="preload" as="image" href="/resources/home.gif">
<link rel="preload" as="image" href="/resources/map-ice.png">
<link rel="preload" as="image" href="/resources/map-candy2.png">
<link rel="preload" as="image" href="/resources/map-candy.png">
<link rel="preload" as="image" href="/resources/map-badlands.png">
<link rel="preload" as="image" href="/resources/main-characters.png">
<link rel="preload" as="image" href="/resources/main-map.png">
<link rel="preload" as="image" href="/resources/discord-white.png">
<link rel="preload" as="image" href="/resources/Cartoon_Network_2010.svg">
{% endblock %}
{% block content %}
<div hidden=""></div>
<main class="main-style">

        <section class="section-hero relative bg-gradient-to-b from-black via-[#0a0a0d] to-black pt-1">
            <div class="mx-auto max-w-7xl px-4 pt-4 pb-4">
                <div class="hero-gif-container rounded-2xl p-8 border border-white/10 shadow-1xl">
                    <img src="/resources/home.gif" alt="Card Wars Kingdom" class="h-20 sm:h-28 lg:h-32 w-auto drop-shadow-2xl mx-auto ">
                </div>
            </div>
            
            <div class="relative flex items-center justify-center overflow-hidden">
                <div class="absolute inset-x-8 inset-y-16 bg-gradient-to-t from-black via-transparent to-transparent z-[1]"></div>
                            <div class="absolute inset-0 grid place-items-center z-[2]">
                    <div class="text-center grid gap-6 px-4 animate-fadeInUp">
                                    <a href="/download" class="shiny-wrap relative inline-flex items-center justify-center rounded-xl bg-brand-500 px-8 py-4 text-white shadow-2xl hover:opacity-95 hover:scale-105 transition-all duration-300 font-semibold text-lg">
                                <span class="relative z-[1] flex items-center gap-3">
                                            </span>
                            </a>       <span class="flex items-center gap-3">
                                    </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section-welcome">
            <div class="gradient-overlay-welcome"></div>
            <div class="container-welcome">
                <div class="flex-welcome">
                        
<h1>
    Welcome to the 'Card Wars Kingdom: Revived.' Original Fandom Wiki<br><br>
    Here you can find all the information about this game. Enjoy and play now click on DOWNLOAD !<br><br>

    And don't forget join DISCORD SERVER
    <br><br>
</h1>

    <table class="factions-table">
        <thead>
            <tr class="main-header">
                <th colspan="6">Factions</th>
            </tr>
        </thead>
        <tbody>
            <tr class="faction-header">
                <th class="blue-plains">Blue Plains</th>
                <th class="cornfields">Cornfields</th>
                <th class="nicelands">Nicelands</th>
            </tr>
            <tr>
                <td class="image-cell">
                    <img src="resources\Faction\Spell_BluePlains_BluePlains.png" alt="Blue Plains">
                </td>
                <td class="image-cell">
                    <img src="resources\Faction\Spell_Corn_Cornlands.png" alt="Cornfields">
                </td>
                <td class="image-cell">
                    <img src="resources\Faction\Spell_Nicelands_Nicelands.png" alt="Nicelands">
                </td>
            </tr>
            <tr class="faction-header">
                <th class="sandylands">Sandylands</th>
                <th class="useless-swamp">Useless Swamp</th>
                <th class="rainbow">Rainbow</th>
            </tr>
            <tr>
                <td class="image-cell">
                    <img src="resources\Faction\Spell_Sands_Sandylands.png" alt="Sandylands">
                </td>
                <td class="image-cell">
                    <img src="resources\Faction\Spell_UselessSwamp.png" alt="Useless Swamp">
                </td>
                <td class="image-cell">
                    <img src="resources\Faction\Rainbow.png" alt="Rainbow">
                </td>
            </tr>
        </tbody>
    </table>

    <h1>
    Menu
</h1>
        <ul class="menu-nav">
        <li><a href="{{ url_for('heroes') }}">Heroes</a></li>
        <li><a href="{{ url_for('creatures') }}">Creatures</a></li>
        <li><a href="{{ url_for('spells') }}">Spells</a></li>
        <li><a href="{{ url_for('multiplayer_pvp') }}">Multiplayer (PvP)</a></li>
        <li><a href="{{ url_for('dungeons') }}">Dungeons</a></li>
        <li><a href="{{ url_for('treasure_chest_cave') }}">Treasure Chest Cave</a></li>
        <li><a href="{{ url_for('store') }}">Store</a></li>
        <li><a href="{{ url_for('status_effects') }}">Status Effects</a></li>
        <li><a href="{{ url_for('labs') }}">Lab's</a></li>
        <li><a href="{{ url_for('specials') }}">Specials</a></li>
    </ul>
    <br>




                        <p data-text-key="index.hero.desc" class="description-p">
                            <span class="bold-span">Dive into the fantastical world</span> of Adventure Time with Card Wars Kingdom, where you can battle your way to the top as a champion of the Card Wars! Join your favorite characters from the Land of Ooo in this epic card game, filled with strategic battles, powerful creatures, and exciting adventures.<br><br>
                            <span class="brand-span">Are you ready to become the ultimate Card Wars champion? Let the battles begin! ⚔️</span>
                        </p>
                    </div>

                            <nav class="main-nav">

                    <div class="lg:max-w-[40%] grid gap-6 place-items-center">
                        <div class="relative group">
                            <div class="absolute -inset-1 bg-gradient-to-r from-brand-500 to-indigo-600 rounded-2xl blur opacity-25 group-hover:opacity-75 transition duration-1000"></div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <section class="section-heroes">
            <div class="gradient-heroes"></div>
            <div class="container-heroes">
                <div class="flex-heroes">
                    <div class="hidden-lg">
                        <img src="/resources/main-characters.png" alt="Main characters" class="heroes-image">
                    </div>
                    <div class="grid-heroes-text">
                        <h1 class="heroes-title">YOUR <br><span class="yellow-span">HEROES</span></h1>
                        <h2 class="heroes-subtitle">✨ IMAGINATION IS YOUR STRONGEST SPELL.</h2>
                        <p class="heroes-p">In Card Wars Kingdom, you'll summon an army of powerful creatures, each with unique abilities and skills that give you the edge in battle. From fiery spells to strategic gameplay, your heroes wield an array of magic that no other deck can match. No two creatures fight alike, and no two battles ever play out the same way.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="section-maps" id="museum-teleporte">
            <div class="container-maps">
                <div class="flex-maps">
                    <div class="grid-maps-text">
                        <h2 class="maps-subtitle">FIGHT AROUND THE ADVENTURE TIME WORLDS</h2>
                        <p class="maps-p">Embark on a thrilling journey through the Adventure Time universe in Card Wars Kingdom! Battle your way through iconic locations like the Grasslands, Ice Kingdom, and the Fire Kingdom. Assemble your team of powerful creatures, unleash magical spells, and take on epic challenges across diverse maps. Discover hidden secrets, collect rare cards, and conquer every battlefield in your quest to become the ultimate Card Wars champion!</p>
                </div>
            </div>
        </section>

        <section class="section-community">
            <div class="container-community">
                <div class="flex-community">
                    <h1 class="community-h1">Join our community on</h1>
                    <a href="https://discord.gg/card-wars-revived-1227932764117143642" target="_blank" class="discord-link">
                        <img src="/resources/discord-white.png" alt="Discord" class="discord-image">
                    </a>
                </div>
            </div>
        </section>
    </main>
    <script>
        // Update online users count
        async function updateOnlineCount() {
            try {
                const response = await fetch('/api/users/online');
                const data = await response.json();
                document.getElementById('online-count').textContent = data.count;
            } catch (error) {
                console.error('Error fetching online count:', error);
            }
        }

        // Send heartbeat to server
        async function sendHeartbeat() {
            try {
                await fetch('/api/users/heartbeat');
            } catch (error) {
                console.error('Error sending heartbeat:', error);
            }
        }

        // Update count every 30 seconds
        updateOnlineCount();
        setInterval(updateOnlineCount, 30000);

        // Send heartbeat every 2 minutes
        sendHeartbeat();
        setInterval(sendHeartbeat, 120000);
    </script>
    <script>
        window.__CREATURES__ = [];
        window.__IS_ADMIN__ = false;
    </script>
    <!-- Add small script at end of body to toggle mobile menu -->
    <script>
		(function(){
			const menuBtn = document.querySelector('button[aria-label="Open menu"]');
			// find the mobile menu panel (the next element with sm:hidden bg..)
			const mobilePanel = Array.from(document.querySelectorAll('div')).find(d => d.className && d.className.includes('sm:hidden') && d.style.overflow === undefined);
			if (menuBtn && mobilePanel) {
				menuBtn.addEventListener('click', () => {
					if (mobilePanel.classList.contains('mobile-menu-open')) {
						mobilePanel.classList.remove('mobile-menu-open');
						mobilePanel.style.maxHeight = '0';
					} else {
						mobilePanel.classList.add('mobile-menu-open');
						mobilePanel.style.maxHeight = '900px';
					}
				});
			}
		})();
	</script>

    <!-- Add admin login/logout logic (after existing scripts) -->
<script>
		(function(){
    // admin elements
    const headerAdminBtn = document.getElementById('headerAdminBtn');
   const headerAdminLink = document.getElementById('headerAdminLink');
    const mobileAdminLink = document.getElementById('mobileAdminLink');
    const loginModal = document.getElementById('loginModal');
    const loginSubmit = document.getElementById('loginSubmit');
    const loginCancel = document.getElementById('loginCancel');
    const loginPwd = document.getElementById('loginPassword');
    const loginStatus = document.getElementById('loginStatus');

    function updateAdminUI() {
        const isAdmin = !!window.__IS_ADMIN__ || document.documentElement.getAttribute('data-is-admin') === '1';
        document.documentElement.setAttribute('data-is-admin', isAdmin ? '1' : '0');

        // Show/hide edit buttons
        const buttons = [
            document.getElementById('headerEditBtn'),
            document.getElementById('pageEditBtn'),
            document.getElementById('editModeBtn'),
            document.getElementById('mobileEditLink')
            // Removed undefined editBtn
        ];
        buttons.forEach(btn => {
            if (btn) btn.style.display = isAdmin ? 'inline-flex' : 'none';
        });

        // Update admin toggle button
        const adminToggle = document.getElementById('adminToggleBtn');
        if (adminToggle) {
            adminToggle.textContent = isAdmin ? 'Logout' : 'Login';
            adminToggle.onclick = isAdmin ? logoutAdmin : showLoginModal;
        }
    }

    async function adminToggleHandler(e) {
        if (e) e.preventDefault && e.preventDefault();
        if (window.__IS_ADMIN__) {
            await fetch('/logout', { method: 'POST' }).catch(()=>{});
            window.__IS_ADMIN__ = false;
            updateAdminUI();
        } else {
            loginStatus.textContent = '';
            loginPwd.value = '';
            if (loginModal) loginModal.style.display = 'flex';
            loginPwd && loginPwd.focus();
        }
    }

    if (headerAdminBtn) headerAdminBtn.addEventListener('click', adminToggleHandler);
    if (mobileAdminLink) mobileAdminLink.addEventListener('click', adminToggleHandler);

    loginCancel && loginCancel.addEventListener('click', () => { if (loginModal) loginModal.style.display = 'none'; });

    loginSubmit && loginSubmit.addEventListener('click', async () => {
        const pwd = (loginPwd && loginPwd.value) || '';
        if (!pwd) { loginStatus.textContent = 'Enter password'; return; }
        loginStatus.textContent = 'Signing in...';
        try {
            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: pwd })
            });
            if (!res.ok) {
                const body = await res.json().catch(()=>({}));
                loginStatus.textContent = body.error || 'Login failed';
                return;
            }
            // --- Comportamiento añadido: igual que en cards.html ---
            window.__IS_ADMIN__ = true;
            if (loginModal) loginModal.style.display = 'none';
            updateAdminUI();
            // Si la página contiene las funciones de edición/recarga del wiki, llamarlas (mismo comportamiento que cards.html)
            try {
                if (typeof window.loadEditableList === 'function') {
                    await window.loadEditableList();
                } else if (typeof window.loadAndRenderWiki === 'function') {
                    await window.loadAndRenderWiki();
                }
            } catch (e) {
                // no bloquear si las funciones no existen o fallan
                console.error('Post-login action error:', e);
            }
            // optionally refresh list endpoint (silent)
            try { await fetch('/creature-book-list'); } catch(e){/*ignore*/};
        } catch (err) {
            console.error(err);
            loginStatus.textContent = 'Network error';
        }
    });

    // init
    updateAdminUI();
})();
	</script>

    <!-- Add Login Modal (desktop + mobile can use it) -->
<div id="loginModal" style="display:none;position:fixed;inset:0;z-index:120;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
	<div class="login-modal-content" style="background:#0b0b0e;color:#fff;">
		<h3 style="margin:0 0 8px 0">Admin Login</h3>
		<form>
			<input id="loginPassword" type="password" placeholder="Password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:1px solid #333;background:#071;color:white;">
			<div style="display:flex;gap:8px;justify-content:flex-end;">
				<button id="loginCancel" style="background:#333;color:#fff;padding:8px 10px;border-radius:6px;border:none">Cancel</button>
				<button id="loginSubmit" style="background:#625fff;color:#fff;padding:8px 10px;border-radius:6px;border:none">Login</button>
			</div>
			<div id="loginStatus" style="margin-top:8px;color:#f88;font-size:13px;"></div>
		</form>
	</div>
</div>
<!-- add script near end of body (after existing scripts) to handle editable texts -->
<script>
(async function(){
    async function fetchTexts() {
        try {
            const r = await fetch('/api/texts');
            if (r.ok) return await r.json();
        } catch(e){console.warn(e);}
        return {};
    }
    async function updateTextServer(key, value) {
        try {
            const r = await fetch('/api/texts/update', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ key, value })
            });
            return r.ok;
        } catch(e){ console.error(e); return false; }
    }

    const texts = await fetchTexts();
    document.querySelectorAll('[data-text-key]').forEach(el => {
        const key = el.getAttribute('data-text-key');
        if (texts && key in texts) {
            el.textContent = texts[key];
        }
        if (window.__IS_ADMIN__) {
            el.setAttribute('contenteditable','true');
            el.style.outline = '1px dashed rgba(255,255,255,0.08)';
            // save on blur
            el.addEventListener('blur', async () => {
                const val = el.textContent || '';
                const ok = await updateTextServer(key, val);
                // optional visual feedback
                if (!ok) { el.style.background = 'rgba(255,0,0,0.06)'; setTimeout(()=>el.style.background='',800); }
            });
        }
    });
})();
</script>
{% endblock %}

{% extends "base.html" %}
{% block additional_preloads %}
<link rel="preload" as="image" href="/resources/home.gif">
<link rel="preload" as="image" href="/resources/map-ice.png">
<link rel="preload" as="image" href="/resources/map-candy2.png">
<link rel="preload" as="image" href="/resources/map-candy.png">
<link rel="preload" as="image" href="/resources/map-badlands.png">
<link rel="preload" as="image" href="/resources/main-characters.png">
<link rel="preload" as="image" href="/resources/main-map.png">
<link rel="preload" as="image" href="/resources/discord-white.png">
<link rel="preload" as="image" href="/resources/Cartoon_Network_2010.svg">
{% endblock %}
{% block content %}
<div hidden=""></div>
<main class="bg-black text-white">

        <section class="relative bg-gradient-to-b from-black via-[#0a0a0d] to-black pt-16">
            <div class="mx-auto max-w-7xl px-4 pt-8 pb-8">
                <div class="hero-gif-container rounded-3xl p-8 border border-white/10 shadow-2xl">
                    <img src="/resources/home.gif" alt="Card Wars Kingdom" class="h-20 sm:h-28 lg:h-32 w-auto drop-shadow-2xl mx-auto animate-float">
                </div>
            </div>
            
            <div class="relative flex items-center justify-center overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent z-[1]"></div>
                <video class="w-full opacity-80 bg-[#0f1923] object-cover max-h-[640px] relative" autoplay muted loop playsinline src="/resources/home-hero.mp4"></video>
                <div class="absolute inset-0 grid place-items-center z-[2]">
                    <div class="text-center grid gap-6 px-4 animate-fadeInUp">
                        <p class="text-white/90 text-lg sm:text-xl font-medium tracking-wide">Cardwars Kingdom Revived</p>
                        <h1 class="text-5xl sm:text-6xl lg:text-7xl font-extrabold drop-shadow-[0_0_30px_rgba(165,50,255,0.5)]" style="font-family:'Rubik Doodle Shadow',system-ui" data-text-key="index.hero.title">
                            Card Wars Kingdom
                        </h1>
                        <div class="mt-4 flex flex-col sm:flex-row gap-4 justify-center">
                            <a href="/download" class="shiny-wrap relative inline-flex items-center justify-center rounded-xl bg-brand-500 px-8 py-4 text-white shadow-2xl hover:opacity-95 hover:scale-105 transition-all duration-300 font-semibold text-lg">
                                <span class="relative z-[1] flex items-center gap-3">
                                    <span class="material-symbols-outlined text-2xl">download</span>PLAY IT NOW
                                </span>
                            </a>
                            <a href="/#museum-teleporte" class="relative inline-flex items-center justify-center rounded-xl bg-white/10 backdrop-blur-md px-8 py-4 text-white shadow-xl hover:bg-white/20 transition-all duration-300 font-semibold text-lg border border-white/20">
                                <span class="flex items-center gap-3">
                                    <span class="material-symbols-outlined text-2xl">explore</span>EXPLORE MORE
                                </span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <nav class="main-nav">
    <ul>
        <li><a href="{{ url_for('heroes') }}">Heroes</a></li>
        <li><a href="{{ url_for('creatures') }}">Creatures</a></li>
        <li><a href="{{ url_for('spells') }}">Spells</a></li>
        <li><a href="{{ url_for('multiplayer_pvp') }}">Multiplayer (PvP)</a></li>
        <li><a href="{{ url_for('dungeons') }}">Dungeons</a></li>
        <li><a href="{{ url_for('treasure_chest_cave') }}">Treasure Chest Cave</a></li>
        <li><a href="{{ url_for('store') }}">Store</a></li>
        <li><a href="{{ url_for('status_effects') }}">Status Effects</a></li>
        <li><a href="{{ url_for('labs') }}">Lab's</a></li>
        <li><a href="{{ url_for('specials') }}">Specials</a></li>
    </ul>
        </nav>


        <section class="bg-white text-black bg-[url('https://i.postimg.cc/J0TRZ6md/Design-sans-titre1.png')] bg-cover relative">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent to-white/50"></div>
            <div class="max-w-7xl mx-auto px-6 py-20 relative z-10">
                <div class="flex flex-col lg:flex-row gap-12 items-start justify-between">
                    <div class="lg:max-w-[80%]">
                        <h1 class="mb-8 text-[40px] leading-[50px] sm:text-[50px] sm:leading-[27px] lg:text-[50px] lg:leading-[50px] font-extrabold tracking-tight drop-shadow-md">
                        WELCOME TO ADVENTURE TIME: CARD WARS KINGDOM!</span>
                        </h1>
                        <p class="text-base sm:text-lg leading-relaxed text-gray-800" data-text-key="index.hero.desc">
                            <span class="font-bold text-xl">Dive into the fantastical world</span> of Adventure Time with Card Wars Kingdom, where you can battle your way to the top as a champion of the Card Wars! Join your favorite characters from the Land of Ooo in this epic card game, filled with strategic battles, powerful creatures, and exciting adventures.<br><br>
                            Build your ultimate deck, summon unique creatures, and challenge players worldwide in this thrilling, fast-paced card battler. Master your strategy, discover powerful combos, and unleash devastating moves to crush your opponents. Whether you're battling in epic PvP duels or embarking on quests with Finn, Jake, and other iconic heroes, there's always an adventure waiting.<br><br>
                            <span class="font-bold text-brand-500">Are you ready to become the ultimate Card Wars champion? Let the battles begin! ‚öîÔ∏è</span>
                        </p>
                    </div>
                    <div class="lg:max-w-[40%] grid gap-6 place-items-center">
                        <div class="relative group">
                            <div class="absolute -inset-1 bg-gradient-to-r from-brand-500 to-indigo-600 rounded-2xl blur opacity-25 group-hover:opacity-75 transition duration-1000"></div>
                            <video class="relative w-full h-auto object-cover rounded-xl shadow-2xl ring-1 ring-white/20" autoplay muted loop playsinline src="/resources/trailer.mp4"></video>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-4 w-full">
                            <img src="/resources/map-ice.png" class="w-full rounded-lg shadow-lg hover:scale-105 transition-transform duration-300" alt="map ice">
                            <img src="/resources/map-candy2.png" class="w-full rounded-lg shadow-lg hover:scale-105 transition-transform duration-300" alt="map candy 2">
                            <img src="/resources/map-candy.png" class="w-full rounded-lg shadow-lg hover:scale-105 transition-transform duration-300" alt="map candy">
                            <img src="/resources/map-badlands.png" class="w-full rounded-lg shadow-lg hover:scale-105 transition-transform duration-300" alt="map badlands">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-brand-500 relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-brand-500 via-purple-600 to-indigo-600"></div>
            <div class="max-w-7xl mx-auto px-6 py-20 relative z-10">
                <div class="flex flex-col lg:flex-row items-center justify-center gap-16">
                    <div class="hidden lg:block lg:max-w-[50%] animate-fadeInUp">
                        <img src="/resources/main-characters.png" alt="Main characters" class="w-full min-h-full drop-shadow-2xl hover:scale-105 transition-transform duration-500">
                    </div>
                    <div class="lg:max-w-[50%] grid gap-6">
                        <h1 class="text-[64px] sm:text-[80px] leading-[64px] sm:leading-[80px] font-extrabold drop-shadow-lg">YOUR <br><span class="text-yellow-300">HEROES</span></h1>
                        <h2 class="text-base sm:text-lg font-bold tracking-wide text-white/90">‚ú® IMAGINATION IS YOUR STRONGEST SPELL.</h2>
                        <p class="text-sm sm:text-base leading-7 text-white/95">In Card Wars Kingdom, you'll summon an army of powerful creatures, each with unique abilities and skills that give you the edge in battle. From fiery spells to strategic gameplay, your heroes wield an array of magic that no other deck can match. No two creatures fight alike, and no two battles ever play out the same way.</p>
                        <a href="/cards" class="w-max px-8 py-4 bg-black text-white hover:bg-yellow-300 hover:text-black transition-all duration-300 rounded-xl font-semibold shadow-xl hover:shadow-2xl hover:scale-105">VIEW ALL HEROES ‚Üí</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-gradient-to-br from-[#ECE8E1] to-[#d4cfc4] text-black relative" id="museum-teleporte">
            <div class="max-w-7xl mx-auto px-6 py-20">
                <div class="flex flex-col lg:flex-row items-center gap-16">
                    <div class="grid gap-6 lg:max-w-[60%]">
                        <h1 class="text-5xl sm:text-6xl font-extrabold text-brand-500 drop-shadow-md">üó∫Ô∏è YOUR MAPS</h1>
                        <h2 class="text-base sm:text-lg font-extrabold tracking-wide text-gray-700">FIGHT AROUND THE ADVENTURE TIME WORLDS</h2>
                        <p class="text-sm sm:text-base leading-8 text-gray-800">Embark on a thrilling journey through the Adventure Time universe in Card Wars Kingdom! Battle your way through iconic locations like the Grasslands, Ice Kingdom, and the Fire Kingdom. Assemble your team of powerful creatures, unleash magical spells, and take on epic challenges across diverse maps. Discover hidden secrets, collect rare cards, and conquer every battlefield in your quest to become the ultimate Card Wars champion!</p>
                        <a href="/cards" class="w-max px-8 py-4 bg-brand-500 text-white hover:bg-indigo-600 transition-all duration-300 rounded-xl font-semibold shadow-xl hover:shadow-2xl hover:scale-105">EXPLORE ALL MAPS ‚Üí</a>
                    </div>
                    <div class="lg:max-w-[40%]">
                        <div class="relative group">
                            <div class="absolute -inset-4 bg-gradient-to-r from-brand-500 to-purple-600 rounded-full blur-xl opacity-50 group-hover:opacity-75 transition duration-1000 animate-pulse"></div>
                            <img src="/resources/main-map.png" alt="Main Map" class="relative w-[420px] max-w-full mx-auto rounded-full border-8 border-white shadow-2xl hover:scale-105 transition-transform duration-500">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="relative bg-[url('/resources/bananas-on-ship.jpg')] bg-cover bg-center">
            <div class="absolute inset-0 bg-black/20"></div>
            <div class="relative max-w-4xl mx-auto px-6 py-28 text-center text-white">
                <div class="stroke-mask text-[72px] sm:text-[96px] leading-none select-none pointer-events-none mb-4">ADVENTURE</div>
                <h3 class="text-lg">Get your</h3>
                <h2 class="text-3xl sm:text-4xl font-bold">Game and rest assured</h2>
                <p class="mt-4 text-sm sm:text-base text-white/90">Our game is open source, meaning anyone can access, review, and contribute to its code. This transparency ensures that the software is secure and free from hidden threats. By allowing the community to inspect and improve the code, we enhance its safety and reliability for all users.</p>
                <div class="mt-8 flex justify-center">
                    <a href="https://github.com/Sgsysysgsgsg/Card-Wars-Kingdom-Revived" target="_blank" class="shiny-wrap relative inline-flex items-center justify-center rounded-md bg-brand-500 px-5 py-3 text-white shadow hover:opacity-95 transition ">
                        <span class="relative z-[1] flex items-center gap-2">VIEW SOURCE CODE</span>
                    </a>
                </div>
            </div>
        </section>

        <section class="bg-[#292929]">
            <div class="max-w-7xl mx-auto px-4 py-8">
                <div class="flex flex-wrap items-center justify-center gap-3 text-white text-center">
                    <h1 class="text-base sm:text-lg">Join our community on</h1>
                    <a href="https://discord.gg/card-wars-revived-1227932764117143642" target="_blank" class="flex items-center justify-center">
                        <img src="/resources/discord-white.png" alt="Discord" class="h-8 w-8 sm:h-12 sm:w-12 object-contain transition-transform hover:scale-110">
                    </a>
                </div>
            </div>
        </section>

        <footer class="bg-[#0a0a0d] py-10 border-t border-white/10 backdrop-blur-lg">
            <div class="max-w-7xl mx-auto px-4 flex flex-col items-center text-center space-y-6">
                <img src="/resources/card-wars-kingdom-icon.png" alt="Card Wars Icon" class="w-16 h-16 drop-shadow-xl">
                <div class="flex flex-col sm:flex-row gap-4 text-sm font-semibold">
                    <a href="/download" class="text-white/90 hover:text-white hover:underline">FREE DOWNLOAD</a>
                    <a href="https://discord.gg/card-wars-revived-1227932764117143642" target="_blank" class="text-white/90 hover:text-white hover:underline">DISCORD SERVER</a>
                    <a href="/heroes" class="text-white/90 hover:text-white hover:underline">HEROES PAGE</a>
                </div>
                <div class="flex items-center gap-8 opacity-70">
                    <img src="/resources/Cartoon_Network_2010.svg" class="h-6" alt="CN">
                </div>
                <p class="text-xs text-white/60 max-w-lg leading-relaxed">
                    ¬© 2025 Card Wars Kingdom Remake ‚Ä¢ Fan Project<br>
                    Cartoon Network‚Ñ¢ &amp; Warner Bros. Discovery own all original rights. No monetization involved.
                </p>
            </div>
        </footer>
    </main>
    <script>
        // Update online users count
        async function updateOnlineCount() {
            try {
                const response = await fetch('/api/users/online');
                const data = await response.json();
                document.getElementById('online-count').textContent = data.count;
            } catch (error) {
                console.error('Error fetching online count:', error);
            }
        }

        // Send heartbeat to server
        async function sendHeartbeat() {
            try {
                await fetch('/api/users/heartbeat');
            } catch (error) {
                console.error('Error sending heartbeat:', error);
            }
        }

        // Update count every 30 seconds
        updateOnlineCount();
        setInterval(updateOnlineCount, 30000);

        // Send heartbeat every 2 minutes
        sendHeartbeat();
        setInterval(sendHeartbeat, 120000);
    </script>
    <script>
        window.__CREATURES__ = [];
        window.__IS_ADMIN__ = false;
    </script>
    <!-- Add small script at end of body to toggle mobile menu -->
    <script>
		(function(){
			const menuBtn = document.querySelector('button[aria-label="Open menu"]');
			// find the mobile menu panel (the next element with sm:hidden bg..)
			const mobilePanel = Array.from(document.querySelectorAll('div')).find(d => d.className && d.className.includes('sm:hidden') && d.style.overflow === undefined);
			if (menuBtn && mobilePanel) {
				menuBtn.addEventListener('click', () => {
					if (mobilePanel.classList.contains('mobile-menu-open')) {
						mobilePanel.classList.remove('mobile-menu-open');
						mobilePanel.style.maxHeight = '0';
					} else {
						mobilePanel.classList.add('mobile-menu-open');
						mobilePanel.style.maxHeight = '900px';
					}
				});
			}
		})();
	</script>

    <!-- Add admin login/logout logic (after existing scripts) -->
<script>
		(function(){
    // admin elements
    const headerAdminBtn = document.getElementById('headerAdminBtn');
   const headerAdminLink = document.getElementById('headerAdminLink');
    const mobileAdminLink = document.getElementById('mobileAdminLink');
    const loginModal = document.getElementById('loginModal');
    const loginSubmit = document.getElementById('loginSubmit');
    const loginCancel = document.getElementById('loginCancel');
    const loginPwd = document.getElementById('loginPassword');
    const loginStatus = document.getElementById('loginStatus');

    function updateAdminUI() {
        const isAdmin = !!window.__IS_ADMIN__ || document.documentElement.getAttribute('data-is-admin') === '1';
        document.documentElement.setAttribute('data-is-admin', isAdmin ? '1' : '0');

        // Show/hide edit buttons
        const buttons = [
            document.getElementById('headerEditBtn'),
            document.getElementById('pageEditBtn'),
            document.getElementById('editModeBtn'),
            document.getElementById('mobileEditLink')
            // Removed undefined editBtn
        ];
        buttons.forEach(btn => {
            if (btn) btn.style.display = isAdmin ? 'inline-flex' : 'none';
        });

        // Update admin toggle button
        const adminToggle = document.getElementById('adminToggleBtn');
        if (adminToggle) {
            adminToggle.textContent = isAdmin ? 'Logout' : 'Login';
            adminToggle.onclick = isAdmin ? logoutAdmin : showLoginModal;
        }
    }

    async function adminToggleHandler(e) {
        if (e) e.preventDefault && e.preventDefault();
        if (window.__IS_ADMIN__) {
            await fetch('/logout', { method: 'POST' }).catch(()=>{});
            window.__IS_ADMIN__ = false;
            updateAdminUI();
        } else {
            loginStatus.textContent = '';
            loginPwd.value = '';
            if (loginModal) loginModal.style.display = 'flex';
            loginPwd && loginPwd.focus();
        }
    }

    if (headerAdminBtn) headerAdminBtn.addEventListener('click', adminToggleHandler);
    if (mobileAdminLink) mobileAdminLink.addEventListener('click', adminToggleHandler);

    loginCancel && loginCancel.addEventListener('click', () => { if (loginModal) loginModal.style.display = 'none'; });

    loginSubmit && loginSubmit.addEventListener('click', async () => {
        const pwd = (loginPwd && loginPwd.value) || '';
        if (!pwd) { loginStatus.textContent = 'Enter password'; return; }
        loginStatus.textContent = 'Signing in...';
        try {
            const res = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ password: pwd })
            });
            if (!res.ok) {
                const body = await res.json().catch(()=>({}));
                loginStatus.textContent = body.error || 'Login failed';
                return;
            }
            // --- Comportamiento a√±adido: igual que en cards.html ---
            window.__IS_ADMIN__ = true;
            if (loginModal) loginModal.style.display = 'none';
            updateAdminUI();
            // Si la p√°gina contiene las funciones de edici√≥n/recarga del wiki, llamarlas (mismo comportamiento que cards.html)
            try {
                if (typeof window.loadEditableList === 'function') {
                    await window.loadEditableList();
                } else if (typeof window.loadAndRenderWiki === 'function') {
                    await window.loadAndRenderWiki();
                }
            } catch (e) {
                // no bloquear si las funciones no existen o fallan
                console.error('Post-login action error:', e);
            }
            // optionally refresh list endpoint (silent)
            try { await fetch('/creature-book-list'); } catch(e){/*ignore*/};
        } catch (err) {
            console.error(err);
            loginStatus.textContent = 'Network error';
        }
    });

    // init
    updateAdminUI();
})();
	</script>

    <!-- Add Login Modal (desktop + mobile can use it) -->
<div id="loginModal" style="display:none;position:fixed;inset:0;z-index:120;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;">
	<div class="login-modal-content" style="background:#0b0b0e;color:#fff;">
		<h3 style="margin:0 0 8px 0">Admin Login</h3>
		<form>
			<input id="loginPassword" type="password" placeholder="Password" style="width:100%;padding:8px;margin-bottom:8px;border-radius:6px;border:1px solid #333;background:#071;color:white;">
			<div style="display:flex;gap:8px;justify-content:flex-end;">
				<button id="loginCancel" style="background:#333;color:#fff;padding:8px 10px;border-radius:6px;border:none">Cancel</button>
				<button id="loginSubmit" style="background:#625fff;color:#fff;padding:8px 10px;border-radius:6px;border:none">Login</button>
			</div>
			<div id="loginStatus" style="margin-top:8px;color:#f88;font-size:13px;"></div>
		</form>
	</div>
</div>
<!-- add script near end of body (after existing scripts) to handle editable texts -->
<script>
(async function(){
    async function fetchTexts() {
        try {
            const r = await fetch('/api/texts');
            if (r.ok) return await r.json();
        } catch(e){console.warn(e);}
        return {};
    }
    async function updateTextServer(key, value) {
        try {
            const r = await fetch('/api/texts/update', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({ key, value })
            });
            return r.ok;
        } catch(e){ console.error(e); return false; }
    }

    const texts = await fetchTexts();
    document.querySelectorAll('[data-text-key]').forEach(el => {
        const key = el.getAttribute('data-text-key');
        if (texts && key in texts) {
            el.textContent = texts[key];
        }
        if (window.__IS_ADMIN__) {
            el.setAttribute('contenteditable','true');
            el.style.outline = '1px dashed rgba(255,255,255,0.08)';
            // save on blur
            el.addEventListener('blur', async () => {
                const val = el.textContent || '';
                const ok = await updateTextServer(key, val);
                // optional visual feedback
                if (!ok) { el.style.background = 'rgba(255,0,0,0.06)'; setTimeout(()=>el.style.background='',800); }
            });
        }
    });
})();
</script>
{% endblock %}
